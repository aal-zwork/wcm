# Rename this distribution example file to motion.conf
#
# This config file was generated by motion 4.3.1+git20200412-392779e
# Documentation:  /usr/local/share/doc/motion/motion_guide.html
#
# This file contains only the basic configuration options to get a
# system working.  There are many more options available.  Please
# consult the documentation for the complete list of all options.
#

############################################################
# System control configuration parameters
############################################################

# Start in daemon (background) mode and release terminal.
daemon off

# Start in Setup-Mode, daemon disabled.
setup_mode off

# File to store the process ID.
pid_file /run/motion/motion.pid

# File to write logs messages into.  If not defined stderr and syslog is used.
;log_file /var/log/motion/motion.log

# Level of log messages [1..9] (EMG, ALR, CRT, ERR, WRN, NTC, INF, DBG, ALL).
log_level 6

# Target directory for pictures, snapshots and movies
target_dir /var/lib/motion

# Video device (e.g. /dev/video0) to be used for capturing.
videodevice /dev/video0

# Parameters to control video device.  See motion_guide.html
; vid_control_params value

# The full URL of the network camera stream.
; netcam_url value

# Name of mmal camera (e.g. vc.ril.camera for pi camera).
; mmalcam_name value

# Camera control parameters (see raspivid/raspistill tool documentation)
; mmalcam_control_params value

# v4l2_palette allows one to choose preferable palette to be use by motion
# to capture from those supported by your videodevice. (default: 17)
# E.g. if your videodevice supports both V4L2_PIX_FMT_SBGGR8 and
# V4L2_PIX_FMT_MJPEG then motion will by default use V4L2_PIX_FMT_MJPEG.
# Setting v4l2_palette to 2 forces motion to use V4L2_PIX_FMT_SBGGR8
# instead.
# V4L2_PIX_FMT_SN9C10X : 0  'S910'
# V4L2_PIX_FMT_SBGGR16 : 1  'BYR2'
# V4L2_PIX_FMT_SBGGR8  : 2  'BA81'
# V4L2_PIX_FMT_SPCA561 : 3  'S561'
# V4L2_PIX_FMT_SGBRG8  : 4  'GBRG'
# V4L2_PIX_FMT_SGRBG8  : 5  'GRBG'
# V4L2_PIX_FMT_PAC207  : 6  'P207'
# V4L2_PIX_FMT_PJPG    : 7  'PJPG'
# V4L2_PIX_FMT_MJPEG   : 8  'MJPEG'
# V4L2_PIX_FMT_JPEG    : 9  'JPEG'
# V4L2_PIX_FMT_RGB24   : 10 'RGB3'
# V4L2_PIX_FMT_SPCA501 : 11 'S501'
# V4L2_PIX_FMT_SPCA505 : 12 'S505'
# V4L2_PIX_FMT_SPCA508 : 13 'S508'
# V4L2_PIX_FMT_UYVY    : 14 'UYVY'
# V4L2_PIX_FMT_YUYV    : 15 'YUYV'
# V4L2_PIX_FMT_YUV422P : 16 '422P'
# V4L2_PIX_FMT_YUV420  : 17 'YU12'
#
v4l2_palette 8

############################################################
# Image Processing configuration parameters
############################################################

# Image width in pixels.
width 1280

# Image height in pixels.
height 720

# Maximum number of frames to be captured per second.
framerate 15
; rotate 0

# Flip the image according to specified axis. 
# Valid values: none, v, h
; flip_axis none

# Locate and draw a box around the moving object. 
# Valid values: on, off, preview
locate_motion_mode on

# Set the look and style of the locate box if enabled. 
# Valid values: box, redbox, cross, redcross
locate_motion_style box

# Text to be overlayed in the lower left corner of images
text_left CAMERA %t

# Text to be overlayed in the lower right corner of images.
text_right %Y-%m-%d\n%T-%q\n%D-%N

# Turns the text showing changed pixels on/off.
; text_changes off
; text_scale 1
; text_event %Y%m%d%H%M%S

############################################################
# Motion detection configuration parameters
############################################################

# Always save pictures and movies even if there was no motion.
emulate_motion off

# Threshold for number of changed pixels that triggers motion.
threshold 1500

# Noise threshold for the motion detection.
; noise_level 32

# Despeckle the image using (E/e)rode or (D/d)ilate or (l)abel.
despeckle_filter EedDl

# Number of images that must contain motion to trigger an event.
minimum_motion_frames 1

# Gap in seconds of no motion detected that triggers the end of an event.
event_gap 20

# The number of pre-captured (buffered) pictures from before motion.
pre_capture 3

# Number of frames to capture after motion is no longer detected.
; post_capture 60
post_capture 30

############################################################
# Script execution configuration parameters
# External Commands, Warnings and Logging:
# You can use conversion specifiers for the on_xxxx commands
# %Y = year, %m = month, %d = date,
# %H = hour, %M = minute, %S = second,
# %v = event, %q = frame number, %t = camera id number,
# %D = changed pixels, %N = noise level,
# %i and %J = width and height of motion area,
# %K and %L = X and Y coordinates of motion center
# %C = value defined by text_event
# %f = filename with full path
# %n = number indicating filetype
# Both %f and %n are only defined for on_picture_save,
# on_movie_start and on_movie_end
# Quotation marks round string are allowed.
############################################################

; on_camera_lost value
; on_camera_found value
; on_event_start /usr/local/etc/motion/on_event_start.sh "%Y" "%m" "%d" "%H" "%M" "%S" "%v" "%q" "%t" "%D" "%N" "%i" "%J" "%K" "%L" "%C" "%f" "%n" "/var/lib/motion"
; on_motion_detected value
; on_area_detected value
on_movie_start /usr/local/etc/motion/on_movie_start.sh "%Y" "%m" "%d" "%H" "%M" "%S" "%v" "%q" "%t" "%D" "%N" "%i" "%J" "%K" "%L" "%C" "%f" "%n" "/var/lib/motion"
on_movie_end /usr/local/etc/motion/on_movie_end.sh "%Y" "%m" "%d" "%H" "%M" "%S" "%v" "%q" "%t" "%D" "%N" "%i" "%J" "%K" "%L" "%C" "%f" "%n" "/var/lib/motion"
on_picture_save /usr/local/etc/motion/on_picture_save.sh "%Y" "%m" "%d" "%H" "%M" "%S" "%v" "%q" "%t" "%D" "%N" "%i" "%J" "%K" "%L" "%C" "%f" "%n" "/var/lib/motion"
; on_event_end 

############################################################
# Picture output configuration parameters
############################################################

# Output pictures when motion is detected
; picture_output off
picture_output best

# File name(without extension) for pictures relative to target directory
; picture_filename %Y%m%d%H%M%S-%q
picture_filename %t/%Y/%m/%d/%H/%H%M%S-%v-%q-%D-%N

# Make automated snapshot every N seconds (default: 0 = disabled)
snapshot_filename %t/%Y/%m/%d/%H/%H%M%S-%v-snapshot

############################################################
# Movie output configuration parameters
############################################################

# Create movies of motion events.
movie_output on

# Maximum length of movie in seconds.
movie_max_time 30

# The encoding quality of the movie. (0=use bitrate. 1=worst quality, 100=best)
; movie_quality 45
movie_quality 65

# Container/Codec to used for the movie. See motion_guide.html
# mpeg4 or msmpeg4 - gives you files with extension .avi
# msmpeg4 is recommended for use with Windows Media Player because
# it requires no installation of codec on the Windows client.
# swf - gives you a flash film with extension .swf
# flv - gives you a flash video with extension .flv
# ffv1 - FF video codec 1 for Lossless Encoding
# mov - QuickTime
# mp4 - MPEG-4 Part 14 H264 encoding
# mkv - Matroska H264 encoding
# hevc - H.265 / HEVC (High Efficiency Video Coding)
movie_codec mp4

# File name(without extension) for movies relative to target directory
; movie_filename %t-%v-%Y%m%d%H%M%S
movie_filename %t/%Y/%m/%d/%H/%H%M%S-%v

movie_extpipe_use off 
; movie_extpipe ffmpeg -y -f v4l2 -input_format mjpeg -video_size %wx%h -framerate %fps -i pipe:0 -c:v libx264 -preset ultrafast -f alsa -acodec pcm_s32le -plughw:0 -f mp4 %f.mp4

############################################################
# Output - Pipe Options
############################################################

# Output images to a video4linux loopback device
# The value '-' means next available (default: not defined)
; video_pipe value

# Output motion images to a video4linux loopback device
# The value '-' means next available (default: not defined)
; video_pipe_motion value

############################################################
# Webcontrol configuration parameters
############################################################

# Port number used for the webcontrol.
; webcontrol_port 0
webcontrol_port 8080

# Restrict webcontrol connections to the localhost.
; webcontrol_localhost on
webcontrol_localhost off

# Type of configuration options to allow via the webcontrol.
webcontrol_parms 0

############################################################
# Live stream configuration parameters
############################################################

# The port number for the live stream.
; stream_port 0
stream_port 8081

# Restrict stream connections to the localhost.
; stream_localhost on
stream_localhost off

##############################################################
# Camera config files - One for each camera.
##############################################################
; camera /usr/local/etc/motion/camera1.conf
; camera /usr/local/etc/motion/camera2.conf
; camera /usr/local/etc/motion/camera3.conf
; camera /usr/local/etc/motion/camera4.conf

##############################################################
# Directory to read '.conf' files for cameras.
##############################################################
; camera_dir /usr/local/etc/motion/conf.d
